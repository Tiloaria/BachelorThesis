\documentclass[specification,annotation]{itmo-student-thesis}

\usepackage{fontspec}
\setmainfont[Mapping=tex-text]{CMU Serif}
\setsansfont{CMU Sans Serif}                %% задаёт шрифт без засечек
\setmonofont{CMU Typewriter Text}  

%% Опции пакета:
%% - specification - если есть, генерируется задание, иначе не генерируется
%% - annotation - если есть, генерируется аннотация, иначе не генерируется
%% - times - делает все шрифтом Times New Roman, собирается с помощью xelatex
%% - languages={...} - устанавливает перечень используемых языков. По умолчанию это {english,russian}.
%%                     Последний из языков определяет текст основного документа.

%% Делает запятую в формулах более интеллектуальной, например:
%% $1,5x$ будет читаться как полтора икса, а не один запятая пять иксов.
%% Однако если написать $1, 5x$, то все будет как прежде.
\usepackage{icomma}

%% Один из пакетов, позволяющий делать таблицы на всю ширину текста.
\usepackage{tabularx}

%% Данные пакеты необязательны к использованию в бакалаврских/магистерских
%% Они нужны для иллюстративных целей
%% Начало
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{filecontents}
\begin{filecontents}{bachelor-thesis.bib}
	@online{ doerr-doerr-lambda-lambda-self-adjustment-arxiv,
		year        = {2015},
		title       = {Optimal Parameter Choices Through Self-Adjustment: Applying the 1/5-th Rule in
			Discrete Settings},
		author      = {Benjamin Doerr and Carola Doerr},
		url         = {http://arxiv.org/abs/1504.03212},
		year        = {2015},
		langid      = {english}
	}
	
	@inproceedings{ example-english,
		year        = {2015},
		booktitle   = {Proceedings of IEEE Congress on Evolutionary Computation},
		author      = {Maxim Buzdalov and Anatoly Shalyto},
		title       = {Hard Test Generation for Augmenting Path Maximum Flow 
			Algorithms using Genetic Algorithms: Revisited},
		pages       = {2121-2128},
		langid      = {english}
	}
	
	@article{ example-russian,
		author      = {Максим Викторович Буздалов},
		title       = {Генерация тестов для олимпиадных задач по программированию 
			с использованием генетических алгоритмов},
		journal     = {Научно-технический вестник {СПбГУ} {ИТМО}},
		number      = {2(72)},
		year        = {2011},
		pages       = {72-77},
		langid      = {russian}
	}
	
	@article{ unrestricted-jump-evco,
		author      = {Maxim Buzdalov and Benjamin Doerr and Mikhail Kever},
		title       = {The Unrestricted Black-Box Complexity of Jump Functions},
		journal     = {Evolutionary Computation},
		year        = {2016},
		note        = {Accepted for publication},
		langid      = {english}
	}
	
	@book{ bellman,
		author      = {R. E. Bellman},
		title       = {Dynamic Programming},
		address     = {Princeton, NJ},
		publisher   = {Princeton University Press},
		numpages    = {342},
		pagetotal   = {342},
		year        = {1957},
		langid      = {english}
	}
\end{filecontents}
%% Конец

%% Указываем файл с библиографией.
\addbibresource{bachelor-thesis.bib}

\begin{document}
	
	\studygroup{M3437}
	\title{Разработка алгоритмов работы с формальной моделью диалогов, представленных в виде графов}
	\author{Савон Юлия Константиновна}{Савон Ю.К.}
	\supervisor{Ульянцев Владимир Игоревич}{Ульянцев В.И.}{доцент, к.т.н.}{доцент факультета информационных технологий и программирования Университета ИТМО}
	\publishyear{2020}
	%% Дата выдачи задания. Можно не указывать, тогда надо будет заполнить от руки.
	\startdate{01}{сентября}{2019}
	%% Срок сдачи студентом работы. Можно не указывать, тогда надо будет заполнить от руки.
	\finishdate{10}{июня}{2020}
	%% Дата защиты. Можно не указывать, тогда надо будет заполнить от руки.
	\defencedate{25}{июня}{2020}
	
	\addconsultant{Ступаков И.М.}{канд. тех. наук, доцент}
	
	\secretary{Павлова О.Н.}
	
	%% Задание
	%%% Техническое задание и исходные данные к работе
	\technicalspec{Требуется провести исследование и разработать набор алгоритмов для выявления отвлечений в графовой модели для телефонной диалоговой системы.
		Алгоритм принимает набор диалогов, в размере нескольких тысяч. Предварительно выстроенный граф и кластеризацию для фраз оператора. 
		
		На выходе ожидается получить набор отвлечений и перестроенный граф. В качестве метрики качества будет использоваться сравнение с уже существующими графами, которые создавались вручную.}
	
	%%% Содержание выпускной квалификационной работы (перечень подлежащих разработке вопросов)
	\plannedcontents{Пояснительная записка должна описывать предметную область диалогов представленных в виде графов. Так же формулировать цель и задачу выделения отвлечений, содержать описание алгоритмов их поиска. Должны быть описаны сложности и методы их разрешения, если они возникали. Кроме того должны быть приведены примеры работы алгоритмов и сравнение с существующими решениями. Кроме того пояснительная записка должна содержать описания задач из смежных областей и их то, как эти задачи связны с задачей решаемой в работе.}%TODO добавить какие конкретно смежные области
	
	%%% Исходные материалы и пособия 
	\plannedsources{\begin{enumerate}
			\item Среда разработки Visial Studio Code;
			\item ГОСТ 7.32--2001 <<Система стандартов по информации, библиотечному и издательскому делу. Отчет о научно-исследовательской работе. Структура и правила оформления>>.
	\end{enumerate}}
	
	%%% Цель исследования
	\researchaim{Разработа алгоритма выделяющего отвлечения в диалоге, представленном в виде графа.}
	
	%%% Задачи, решаемые в ВКР
	\researchtargets{\begin{enumerate}
			\item Разработать алгоритмы выделения отвлечий;
			\item Реализовать описанные алгоритмы;
			\item Перестроить граф в соответствии с используемой моделью в компании;
			\item Проанализировать результаты работы алгоритмов;
			\item Интегрировать разработки в инфраструктуру компании.
	\end{enumerate}}
	
	%%% Использование современных пакетов компьютерных программ и технологий
	\addadvancedsoftware{Пакет \texttt{tabularx} для чуть более продвинутых таблиц}{\ref{sec:tables}, Приложения~\ref{sec:app:1}, \ref{sec:app:2}}
	\addadvancedsoftware{Пакет \texttt{biblatex} и программное средство \texttt{biber}}{Список использованных источников}
	
	%%% Краткая характеристика полученных результатов 
	\researchsummary{}
	
	%%% Гранты, полученные при выполнении работы 
	\researchfunding{}%TODO вписать стипендию
	
	%%% Наличие публикаций и выступлений на конференциях по теме выпускной работы
	\researchpublications{По теме этой работы был сделан доклад на Конгрессе Молодых Ученых.
		%\begin{refsection}
		%%Однако покажу, как можно ссылаться на свои публикации из списка литературы:
		%%\nocite{example-english, example-russian}
		%%\printannobibliography
		%\end{refsection}
	}
	
	%% Эта команда генерирует титульный лист и аннотацию.
	\maketitle{Бакалавр}
	
	%% Оглавление
	\tableofcontents
	
	%% Макрос для введения. Совместим со старым стилевиком.
	\startprefacepage
	
	Эта работа посвящена исследованию в области диалоговых систем.
	
	Диалоговая система -- алгоритм, который умеет принимать участие в диалоге на естественном языке и использует правила общения между людьми.
	
	В качестве примера диалоговых систем можно привести: 
	\begin{itemize}
		\item чат-боты
		\item голосовые помощники
		\item автоответчики в колл-центрах
	\end{itemize}

	Такие диалоговые системы могут быть как довольно простыми (например чат-бот отвечающий на заранее известный набор команд), так и сложными (например бот, отвечающий на вопрос на естественном языке и в качестве ответа возвращающий некоторую информацию из базы знаний).
	
	В последнее время набрали популярность технологии распознования и генерации речи, которые позволили создавать диалоговые системы, ведущие телефонный разговор. Данная работа заточена под алгоритмы для телефонных звонков.
	
	Такие звонки с одной стороны должны быть не отличимы от звонков человека, с другой они должны придерживаться некоторого сценария.
	
	\textbf{Сценарий диалога с оператором} — некоторый алгоритм, предоставленный человеку, который звонит по заданному набору телефонных номеров. Целью сценария обычно является получить или донести до клиента информацию. 
	
	Несмотря на то, что под сценарием диалога мы понимаем некоторый алгоритм, необходимо понимать что для человека и диалоговой системы это принципиально разные сущности. Между скриптом\footnote{Здесь и далее в тексте \textbf{скрипт} и \textbf{сценарий} будут использоваться как синонимы} и алгоритмом, с точки зрения набора действий для машины есть большая разница. 
	
	Для человека это скорее список вопросов которые он должен задать и информация о возможных продуктах и услугах. Кроме того человек может помнить некоторые факты и выдавать их дополнительно зависимости от контекста. он сам умеет обрабатывать ситуации такие как отвлечение от основных вопросов или переспрашивание.
	
	Для графа же, любую реакцию надо прописывать, все возможные данные хранить и обновлять. Кроме того есть требование поддерживать этот скрипт доступным для восприятия человеком (например лингвистом), поскольку возникает необходимость в ручном анализе и редактировании.
	
	\textbf{Телефонная диалоговая система} — программа, которая используя сценарий умеет проводить диалог с клиентом, интерпретировать и записывать  информацию полученную от клиента, а так же состояния завершенного разговора. Кроме того робот умеет отвечать на заранее прописанный в скрипте набор вопросов и возвращаться обратно к диалогу.
	
	На данный момент существуют графы для диалогов, которые создаются вручную. Но писать их долго, а продумывать все важные случаи реакций сложно и трудоёмко. 
	
	Кроме того хочется иметь возможность усложнять вариативность диалогов. В связи с этим, ставится глобальная задача по представлению набора диалогов в виде графа. 
	
	Поскольку некоторые из вопросы или дискуссии могут возникнуть в любом месте диалога. И количество таких случаев достаточно велико. То было решено отделить их в отдельные подграфы и сделать возможность переходить в них при некоторых условиях из каждой вершины. Вдальнейшем мы будем называть такие случаи \textbf{отвлечениями}.
	
	В работе будут рассмотрены различные алгоритмы поиска таких отвлечений. А так же рассмотренны варианты улучшения для кластеризации, использующие данные о контексте.
	
	%% Начало содержательной части.
	\chapter{Обзор}
	\section{Описание предметной области}
	Изначальная общая задача стоит следующая: есть диалоги, необходимо восстановить граф и найти отвлечения.
	
	На данный момент кроме восстанавливаемой нами модели есть граф который составляется вручную. В этом графе вершинами являются кластеры фраз диалоговой системы, а рёбрами фразы человека. То есть при ответах человека происходит переход в разные новые вершины.
	
	Особенностями данной структуры, которые важно отметить, является то, что помимо обычных переходов существуют так же скрытые переходы, которые по умолчанию могут встретиться в любом месте. В качестве примера можно привести вопрос: <<А какую компанию вы представляете?>>. При звонке люди могут задать этот вопрос не сразу.
	
	Для того, чтобы не рассматривать каждый такой случай при переходе из каждой вершины, выделяются $\textbf{отвлечения}$. 
	
	$\textbf{Отвлечение}$ - вопрос, который может быть задан в любом месте диалога. 
	
	В задаче восстанавления будет использоваться несколько другой граф. В нём вершинами будут являться кластеры и фраз оператора, и фраз человека. А ребрами последовательные пары фраз из кластеров в диалоге.
	
	\section{Анализ}
	На вход подаётся набор диалогов по которым нужно получить граф для диалоговой системы, который бы мог проводить аналогичные диалоги.
	
	Граф, если получать его путём обычной кластеризации операторских фраз, получается очень громоздким. В нём плохо видно структуру, его сложно анализировать.
	
	Поскольку конечной целью является построить автомат аналогичный тому, что работает в продуктовой части команды, то появляется требование привести его в состояние, когда его можно изучать вручную. 
	
	То есть так же как и в графе создаваемом вручную, появляется необходимость выделить отвлечения. В этом случае его структура становится более удобной для изучения. Его можно использовать как вспомогательный инструмент. 
	
	Такие выделения отвлечений позволяют грамотно обрабатывать сценарии, которых не было в изначальном наборе диалогов. Если такие отвлечения не выделить, то в случае вопроса, не предусмотренного в этом месте диалоговая система либо ответит невпопад, либо зависнет.
	
	Необходима хорошая кластеризация текстов, поскольку любой алгоритм выделения отвлечений так или иначе будет опираться на эту кластеризацию. При таких кластеризациях полезно учитывать имеющуюся информацию, то есть фразы до текущей и после.
	
	
	\section{Постановка задачи}
	В связи с описаной выше проблемой громоздкости графа, появляется задача выделить отвлечения, которые могли бы встретиться в любом месте.
	
	В случае, когда диалог проводит оператор такие вопросы нет необходимости расписывать, но диалоговой системе нужен чёткий скрипт.
	
	Необходимо выделить отвлечения и перестроить граф таким образом, чтобы он покрывал большее количество диалогов и его было проще анализировать.
	
	\section{Выводы по первой главе}
	Рассмотрена предметная область графовой структуры диалогов. Разобрана структура продуктового графа и структура графа для восстанавливаемой модели. Проведён анализ задачи восстановления графа. Поставлена задача выделения отвлечений. 
	
	\chapter{Теоретическая часть}
	\section{Модель предлагаемого решения}
	Поскольку граф на данном этапе всё ещё перестраивается, то информация о произнесенных человеком фразах является полезной, так как содержит в себе контекст. Поэтому мы оставляем фразы человека в качестве вершин.
	
	Нужно понимать, что изначально кластеризация проводилась только по фразам оператора. Фразы вершин же были разделены на группы, где для каждой группы совпадала предыдущая и последующая вершины оператора. И уже внутри этих групп бились на некоторые подгруппы.
	
	Рассмотрим два подхода в решении задачи выделения отвлечений:
	
	\begin{itemize}
		\item Первый подход заключается в том, чтобы выделить вершины, в которые идёт много рёбер. Порог считается функцией от количества кластеров на которые бъются фразы оператора.
		
		Мы предполагаем, что поскольку отвлечение встречается в разных местах, то и рёбра будут идти в него из множества различных вершин. Такая гипотеза является хорошей, поскольку в обычном графе в вершину обычно приходит одна или две ветки, в случае же отвлечения их должно быть много, или же оно встречается крайне редко.
		
		\item В качестве другого подхода можно выделить циклы и сказать, что вершина следующая в диалоге за вершиной повторения с некоторой вероятностью будет являться началом отвечения.
		
		Здесь мы пользуемся наблюдением, что после отвлечения на стронний вопрос, оператор зачастую повторяет ту же или схожую фразу для возвращения в сценарий. Более того, эта идея используется в графе, который реализован для реального окружения. Там диалоговая система так же повторяет фразу, её сокращенную версию или её иную формулировку, которую произносил, перед тем, как перейти в отвлечение.
	\end{itemize}\hskip
	
	Поскольку подходы используют разные идеи их так же имеет смысл комбинировать и использовать данные полученные в обоих подходах.
	
	\section{Соответствие поставленным требованиям}
	Такие алгоритмы позволят найти для диалогов которые были проведены с системой, отвлечения, и сопоставить их с выделенными лингвистами вручную для графа.
	
	\chapter{Реализация}
	\section{Подход с большим количеством рёбер входящих в вершину}\\
	Выбираются вершины, в которые входит много ребер. Для значений размеров кластеров в интервале от двенадцати до пятнадцати был выбран параметр три. При увеличении количества кластеров соответственно должен увеличиваться и порог.
	
	Во время тестирования на реальных диалогов человека с человеком была выявлена важная особенность. На работу алгоритма очень сильно влияет качество кластеризации. Поскольку фразы в телефонных диалогах не всегда верно переводятся в текст, сами фразы сравнительно короткие. А в случае людей-операторов ещё и очень вариативные, то кластеризация оказалась очень некачественной.
	
	\section{Подход с поиском циклов}\\
	После кластеризации ищутся пары вершин для которых кластеры совпадают. Так же было добавлено ограничение на расстояние между ними в диалоге. Оно должно быть не слишком велико, поскольку ясно что отвлечение бывает длинным очень редко, а иначе можно случайно выкинуть почти весь диалог.
	
	В этом случае в качестве потенциальных отвлечений мы выбираем вершины человеческих фраз которые первые следуют после начала цикла. После перевода графа в продуктовый режим у нас эти вершины станут рёбрами и таким образом это будут триггеры, которые будут перенаправлять русло диалога в отвлечение.
	\section{Улучшение кластеризации}
	В качестве решения проблемы некачественной кластеризации было предложено использовать данные из фраз человека. До этого для всех фраз человека между двумя фразами оператора, они кластеризировались и никак не использовались. 
	
	Было решено кластеризировать тексты пользователей. Но поскольку как описывалось выше, кластеризация не достаточно хорошая, то необходимо было отсеять плохие кластеры во избежание каскадных ошибок.
	
	%Нужно понимать, что если отсеять всё кроме одинаковых фраз, то их останется очень мало и ценной информации они нести не будут.
	
	Для этого использовалось попарное сравнение фраз внутри каждого кластера. Для этого сравнивались наборы слов внутри фразы с весами. Если точность превышала порог 0.5, то пара считалась хорошей.
	
	Константа 0.5 была выведена эмперически. Для большего значения в кластре начинало содержаться большое количество фраз разных по смыслу. 
	
	Проверять все пары оказалось очень долго $O(n^2)$, а в предыдущей части восставновления все операции имели ассимтотику не более чем $O(n \log n)$, то получилось так, что эта часть занимала значительно больше половины времени от всего восстановления графа. 
	
	Тогда было решено для каждого кластера брать случайную выборку, равная утроенному размеру кластера, ассимптотически это занимало уже $O(n)$. В силу достаточно больших размеров кластеров (размер их для основной массы данных состовляет несколько сотен фраз нескольких сотен фраз), статистически показывало те же результаты, что и полная выборка.
	
	Ниже приведён псевдокод для данной функции:
	
	
	\chapter{Полученные результаты}
	\section{Используемые данные}
	В качестве данных использовалось два принципиально разных типа наборов диалогов. Первые проводились уже с существующим роботом скриптом. Второй тип, это данные диалогов человека с человеком.
	
	Особенность первого заключается в том, что там легко кластеризовать фразы оператора, так как они произносятся всегда одинаково. Так же для этого случая есть возможность перевести полученный граф в тот же формат и сравнить полученный результат с оригиналом.
	
	Особенности второго соответсвенно следующие: во первых там говорят разные операторы и у них разный стиль подачи одних и тех же данных. Во вторых диалоги более сложные и зачастую отходят от скрипта. В третьих люди решают более сложные вопросы и умеют давать ответы на не предусмотренные скриптом вопросы. На этот вариант данных стоит ориентироваться, но в связи с отсутствием оригинального скрипта в удобном формате напрямую сравнить полученный результат представляется возможным только вручную.
	
	В обоих случаях есть сложности с переводом речи людей в текст, поэтому иногда даже рассматривая текст диалога вручную нельзя понять что человек имел ввиду.
	
	\section{Улучшение кластеризации}
	Алгоритм вносит небольшие изменения и способен объединять некоторые одинаковые кластеры. 
	
	Основная сложность состояла в анализе, так как для данных из разговоров с искуственным интелектом кластеризация фраз оператора изначально была очень хорошей в силу того, что фразы повторялись. Для случаев разговоров человека с человеком анализ результатов приходилось проводить вручную в силу отсутствия разметки данных.
		
	\section{Алгоритм поиска отвлечений по рёбрам}
	Для данного алгоритма критично качество кластеризации и наличие небольшого количества выбросов. 
		
	В случае с данными из реальных диалогов зачастую не было видно правильно выделеных отвлечений из-за смешения кластеров и операторских и человеческих вершин.
		
	Для данных из диалогов с существующей диалоговой системой алгоритм находил практически все отвлечения. Основная причина столь большого различия в том, что операторские фразы во втором случае кластеризуются практически идеально.
	
	\section{Поиск циклов}
	После того, как мы нашли циклы мы их удаляем, таким образом основной граф становится менее громоздким и его легче анализировать. Из особенностей реализации важно отметить, что удаляются не все циклы, а только размера не более чем 5. В противном случае если случилось например два цикла в одном диалоге с <<Повторите пожалуйста>>, то будут удалены все промежуточные состояния, которые не являются отвлечениями.%вставить полноценный обезличенный пример и картинки со случаями, и код
	
	Ниже приведена таблица, в ней видно как уменьшается размер графа при удалении циклов:
	
	\begin{tabular}{|c|с|c|c|}
	\hline
	Номер датасета & размер & количество вершин & количество рёбер\\
	\hline
	1&10000 & 141 & 587\\%log_zar-ru_10000
	&		& 134 & 528\\ %12
	\hline
	2&661&71&194\\ %13 zar-ru-di
	 &   &67&179\\
	\hline
	3&1000&155&570\\ %12 log_alp_oper
	 &    &142&479\\
	\hline
	4&1086&98&283\\ %14 modul
	 &    &92&252\\
	\hline
	5&998&159&753\\
	 &   &142&631\\ %grep
	\hline
	6&5000&48&137\\ %13
	 &    &46&120\\
	\hline
	7&10000&88&296\\%logs modul
	 &     &87&293\\
	\hline
	8&10000&112&515\\%logs alfa
	 &     &111&506\\
	\hline
	9&3325&161&1078\\
	 &    &154&955\\ %17
	\hline
	10&10000&116&473\\
	  &     &115&457\\ %15
	\hline
	11&588&122&366\\
	  &   &115&340\\ %15 alpha dial
	\hline
	
	\end{tabular}\\

	Среди этих датасетов есть 2 принципиально разных типа:
	Первый тип -- оператор+человек, эти датасеты нам предоставили компании и в них человек придерживается некоторого скрипта, но заметно от него отклоняется, поэтому при меньших размерах порядок вершин в них такой же. К этому типу относятся соответственно датасеты 2, 4, 5, 9, 11.
	
	Второй тип -- искуственный интелект+человек, эти датасеты были собраны соответственно компанией при звонках со скриптами написанными вручную. К этому типу соответственно относятся 1, 3, 6, 7, 8, 10.
	
	В обоих типах при увеличении размера датасета увеличивается количество вершин. Важно отметить, что большинство из вершин, это ответы человека, количество же операторских вершин примерно равно 15. Для случая диалогов человека с человеком размеры графа могут быть изначально больше, это объясняется тем, что в нём больше вариативность фраз.
	
	Вырезанные ребра и вершины соответственно отделяются и становится проще анализировать граф.
	
	Если рассмотреть какие вершины из операторских попадают в циклы, то хорошо видно тенденцию того, что есть несколько вершин у которых большое количество ответов попадает в циклы. Некоторые такие вершины, как можно заметить исчезают вообще. Для остальных можно подобрать пороговое значение при котором можно будет считать, что вершина является триггером отвлечения.
	
	\chapter{Заключение}
	В ходе выполнения работы была рассмотрена задача выделения отвлечений в модели графа для телефонной диалоговой системы. Для её решения были разработаны и написаны алгоритмы основанные на особенностях разговоров оператора с человеком. Были учтены особенности существующей модели графовых диалогов и данные полученные при её использовании.
	
	Были написаны алгоритмы выделения циклов и поиска отвлечений по рёбрам. Кроме того в ходе разработки возникла необходимость улучшить кластеризацию, для чего был разработан алгоритм для улучшения кластеризации на основе данных о соседних фразах.
	
	Одно из возможных направлений развития работы, использовать информацию о пользователе в диалоге, сделав его таким образом более естественным. Так же существует возможность выделить некоторые общие отвлечения для всех диалогов, получая таким образом возможность предсказывать отвлечения в виде подсказок.
	
	По завершению восставления диалоговой системы работу проделанную выше планируется использовать в реальном окружении, автоматизировав часть рабочих процессов.
	
\end{document}
